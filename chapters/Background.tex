%background.TeX

Due to the stringent cuts in the tight signal region and absense of resonance, MC simulation suffers from low statistics for some background processes.  
Therefore, in addition to the MC simulation, a data driven method is used to estimate a significant portion of background that is not reliably estimated using MC.

The hadronic $\tau$ decays produce jets; therefore, jets coming from other processeses effectively fake the hadronic $\tau$ signature. This is a non-trival fake rate that needs to be measured and accounted for in this analysis. 

In order to conduct the data driven method, a proportion is made to extract the jet faking tau background. Generally, this proportion is constructed using a region orthogonal to the statistical hypothesis test. For example, one requirement could be a charge sign inversion on a lepton pair used in the final state. In this orthogonal region and in the tight signal region, tight and loose identification criteria are made to extrapolate the scale factor that estimates the tau's fake rate. 
The tight identification should be excellent at selecting genuine tau leptons and the loose identification more inclusive to all tau leptons, even those that are fake. 
Therefore, using the orthogonal reigons---same sign and opposite sign---along with the loose signal region, one can extrapolate the number of events in the tight signal region. Due to the four regions, the method is also referred to as the ``ABCD" method. 


\section{Brief outline of the fake rate method}
The fake rate function in the same sign (SS) region is \textit{known}.
Events passing loose identification---that includes tight indentification---in the opposite sign (OS) region is \textit{known}.
Events passing in the tight signal region is \textit{unknown}. 
Assuming that the loose and tight identification is not dependent on the sign of the leptons. Then one can make the equivalence statement: 
\begin{equation}
\label{eq:abcd}
\frac{\text{Events}_\text{SS Tight}}{\text{Events}_\text{SS Loose}} \doteq \frac{\text{Events}_\text{OS Tight}}{\text{Events}_\text{OS Loose}}
\text{.}
\end{equation}
To make the expression more precise, the fake rate function is typically parametrized in lepton candidate transverse momentum. 
 Also, prompt MC is subtracted from data, which is motivated by estimating the true jet faking tau background (non-prompt taus). If tau leptons in MC are identified as prompt then it is unlikely that the tau is a jet, so they are removed: 
\begin{equation}
f(p_T)=\frac{\text{Data Events}_\text{S.S. Tight} - \text{Prompt MC Background}_\text{S.S. Tight}}{{\text{Data Events}_\text{S.S. Loose} - \text{Prompt MC Background}_\text{S.S. Loose}}}
\text{.}
\end{equation} 

After the measurement is made for each tau candidate, the fake rate is applied as an event weight---$w(f(p_T))$ a transfer function explained~\ref{eq:frw}---to the opposite sign loose region in order to extrapolate to the tight signal region. So isolating the events in the tight signal region and flipping the relation in equation \ref{eq:abcd}, one obtains the result: 
\begin{equation}
\text{Events}_\text{OS Tight} = w(f(p_T))\cdot \text{Events}_\text{OS Loose} \;\text{.}
\end{equation}

\section{Measurement of the fake rate}
To measure the fake rate, multiple categories are considered and motivated through the processes which produce jets. As outlined in the SM Higgs decays to tau leptons analysis and its supporting document on fake rate measurements, several regions are used to determine the fake rate ~\cite{SMHTTarXiv}. The separate jet ``enriched" background processes are used for each final state
\begin{itemize}
	\item QCD multijet targeting the majority of jetâ†’ \tauh fake events in the $\mu\mu\tau\tau$ final state,
	\item W+jets targeting jets mostly in the $\mu\mu e\tau$ and $\mu\mu\mu\tau$ final states,
	\item \ttbar events targeting fully-hadronic or semi-leptonic decays.
\end{itemize} 



The fake rates are then measured as a function of $p_T$ of the object and for final states involving hadronic tau leptons, and are further split into subcategories depending on the decay mode.  
W+jets with no jets and one jet, QCD multi-jet with no jets, one jet, and more jets, and $t\bar{t}$ inclusive jets make up the total number of background categories that are measured. 
At high hadronic tau $p_T$ (greater than 100\GeV), negative fake rates are possible because of low statistics and the linear fit model extrapolation, so if the candidate tau has a $p_T$ of greater than 100\GeV the rate at 100\GeV is applied. 
In order to combine the fake rates from these ``enriched'' background processes and use it in an ABCD approach, the fraction of events for each of the background process are combined in an overall fake rate that is still parametrized by $\pt$ and category.  

%In the QCD multijet region, there is no way to estimate it with pure MC simulation. Therefore, in order to estimate the QCD contribution all MC simulation events are subtracted before the measurements. Then the remaining fake rate measurement in the determination region is assumed to be from QCD.

%In the W+Jets region, similarly all MC is subtracted except for the W+Jets simulation. Note that QCD contamination is minimal because of the dominance of the W boson resonance. 

%In the $t\bar{t}$ region it is the same as the W+Jets regions, except the subtraction is $t\bar{t}$; however, there is also an isolation region that is used because the fake rate for this process is expected to be very small and actually calculable using MC, so in addition to the genuine $t\bar{t}$ events, the fraction of jets faking hadronic taus are also included in the subtraction. 


%For more information on the specfic events that are targeted in the QCD multijet, W+Jets, and $t\bar{t}$ regions the SM reference has all the categories with a detailed description of the subtraction  

Therefore the following steps are done for each final state to measure the fake rate:
\begin{enumerate}
\item[1.] Determine fake rate scale factor parametrized in candidate lepton $\pt$ in the QCD, W+jets, and $t\bar{t}$ regions
\item[2.] Make corrections based on the other lepton in the channel for closure 
\item[3.] Make corrections based on the differences between the first step and the signal region
\item[4.] Determine the fraction of QCD, W+jets, and $t\bar{t}$ events in the signal region.
\end{enumerate} 

To help in the understanding of the measurement regions, a table listing the enriched background and targeted final state along with the cuts and the anti-isolation requirement (the non-orthogonal condition in the ABCD method) will be presented. 
As indicated in the tables below, $\mu\tau$ and $ e \tau$ measured states share the same categories. For the $\tau\tau$ state, only the QCD ``enriched'' background category is considered. 
For the $\mu\mu e\mu$ final state in the application, the fake rate measurements from the $\mu\tau$ and $e \tau$ measured states are used for the corresponding lepton ($\mu or e$). 


\begin{table}[h!tbp]
\centering
\topcaption{Jet ``enriched'' background categories with cuts for each measured state, $\mu\tau$ and $e \tau $ have the same so they will be combined with the assumption that $l$ demarcates the muon or electron. Baseline selection cuts for events are made by default as listed in section~\ref{chap:selection} without the signal extraction cuts. 
\label{tab:ffmeasure}
}
\begin{tabular}{|c|c|p{0.3\textwidth}|p{0.3\textwidth}|}
\hline
background &  measured state      &  cuts & anti-isolation \\\hline 

QCD & $\mu\tau$/$ e\tau$  & SS leptons Isolation \hspace{.1\linewidth} $l$ $\in(0.02,0.15)$ & $\tau$ VVVLoose DNN but fails Med. DNN \\
    & $\tau\tau$  & SS leptons subleading $\tau$ pass Med. DNN and leading VVVLoose DNN & leading $\tau$ fails Med DNN \\\hline

W+Jets & $\mu\tau$/$ e\tau$  & SS leptons $m_T$ between $l$ and $p_T^{\text{miss}}$ $> 70 $ GeV & $\tau$ VVVLoose DNN but fails Med. DNN \\\hline

$t\bar{t}$ & $\mu\tau$/$ e\tau$  & SS leptons number of b-tag jets $\geq 1 $ & $\tau$ VVVLoose DNN but fails Med. DNN \\\hline
\end{tabular}
\end{table}
Fake factor measurements for the $\mu\tau$ measured state in the QCD region for 2017 is included in figure \ref{fig:fit_raw_mt_0jet_qcd}. 
Only plots pertaining to the $ e \tau$ and $ \mu \tau$ states were created, but all states measured. 
The rest of the measurements are included in Appendix \ref{app:ffmeas}. For a more detailed description of the data driven background method along with the measurements for the closure and extra correction terms regard reference~\cite{AN16355}.




\begin{figure}[ht!b]
\centering
%\includegraphics[width=0.31\textwidth]{Figures/FF/plots_mt_2016/fit_rawFF_mt_qcd_0jet.pdf}
\includegraphics[width=0.85\textwidth]{Figures/FF/plots_mt_2017/fit_rawFF_mt_qcd_0jet.pdf}\\
%\includegraphics[width=0.31\textwidth]{Figures/FF/plots_mt_2018/fit_rawFF_mt_qcd_0jet.pdf}\\
\caption{\label{fig:fit_raw_mt_0jet_qcd} Fake factors determined in the QCD multijet determination region with 0 jets in the $\mu\tau$ measured state in 2017. They are fitted with linear functions as a function of the $\tauh$ $\pt$. The green and purple lines indicate the shape systematics obtained by uncorrelating the uncertainties in the two fit parameters returned by the fit.  }
\end{figure}





\clearpage

\section{Application of the fake rate method}

After the jet faking tau rate is measured, it is then applied to events that are identified as loose and not tight. Since the final state involves two tau leptons, this procedure is applied to each tau lepton in the final state, thus requiring application of the fake rate in three different scenarios. The final weight is then applied depending on the pass and fail criteria of each lepton candidate. In the scenario where the event fails both candidate requirements, then a minus sign is included, to avoid the case of double counting.  
 The weight is effectively a transfer factor that is created using the fake rate measured earlier. The transfer factor has its form because the weight is the ratio of tight to loose---tight excluded---instead of tight to loose---tight included. 
\begin{itemize}
\item{If event fails identification for $\tau$ 1:\begin{equation}\label{eq:frw} w_1(p_T)=\frac{f_{1}(p_T)}{1-f_{1}(p_T)}\end{equation}}
\item{If event fails identification for $\tau$ 2:\begin{equation}w_2(p_T)=\frac{f_{2}(p_T)}{1-f_{2}(p_T)}\end{equation}}
\item{If event fails identification for both:\begin{equation}w_{12}(p_T)=-\frac{f_{1}(p_T)}{1-f_{1}(p_T)}\cdot\frac{f_{2}(p_T)}{1-f_{2}(p_T)}\end{equation}}
\end{itemize}

To illustrate the different regions in the ABCD method along with each tau candidate, a diagram was drawn depicting the scenarios and is shown in figure \ref{fig:fakefactor_reg}. 
\begin{figure}[ht!b]
\label{fig:fakefactor_reg}
  \includegraphics[width=0.9\textwidth]{"Figures/fakefactor_diagram.pdf"}
    \caption{ ABCD method diagram depicting the measurement and application regions for each \tauh lepton in the final sate.}
\end{figure}

This fake factor methodology has been used by other analyses such as the SM Higgs measurement with an associated Z boson ~\cite{CMS-PAS-HIG-19-010} . 

For a closure test, the same criteria are applied to the selection of the tight same sign region. The vast majority of the background should be jets faking taus in that case. Indeed it is shown in figure \ref{fig:fakefactor_validation}.
  
\begin{figure}[ht!b]
  \includegraphics[width=0.65\textwidth]{"Figures/outplots_2016_smFF_mmmt_Nominal/AMass_blinded_mmmt_FF_SS_validation.png"}
    \caption{\label{fig:fakefactor_validation} Validation of the fake factor method. Fake factors are applied to the same sign tight region.}
\end{figure}
